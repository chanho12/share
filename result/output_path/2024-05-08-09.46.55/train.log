[2024-05-08 10:46:57,558] [INFO] [real_accelerator.py:203:get_accelerator] Setting ds_accelerator to cuda (auto detect)
[93m [WARNING] [0m async_io requires the dev libaio .so object and headers but these were not found.
[93m [WARNING] [0m async_io: please install the libaio-dev package with apt
[93m [WARNING] [0m If libaio is already installed (perhaps from source), try setting the CFLAGS and LDFLAGS environment variables to where it can be found.
[93m [WARNING] [0m Please specify the CUTLASS repo directory as environment variable $CUTLASS_PATH
[93m [WARNING] [0m sparse_attn requires a torch version >= 1.5 and < 2.0 but detected 2.3
[93m [WARNING] [0m using untested triton version (2.3.0), only 1.0.0 is known to be compatible
[2024-05-08 10:46:58,118] [WARNING] [runner.py:202:fetch_hostfile] Unable to find hostfile, will proceed with training with local resources only.
[2024-05-08 10:46:58,118] [INFO] [runner.py:568:main] cmd = /home/chanho/anaconda3/envs/COMEDY/bin/python -u -m deepspeed.launcher.launch --world_info=eyJsb2NhbGhvc3QiOiBbMCwgMV19 --master_addr=127.0.0.1 --master_port=8888 --enable_each_rank_log=None training/SFT/main.py --model_name_or_path /home/chanho/Model/COMEDY/EPISODE/result/model_path --train_data_path /home/chanho/Model/COMEDY/EPISODE/result/dataset/train_data.json --valid_data_path /home/chanho/Model/COMEDY/EPISODE/result/dataset/test_data.json --per_device_train_batch_size 1 --per_device_eval_batch_size 1 --data_output_path /home/chanho/Model/COMEDY/EPISODE/result/output_path/data --max_seq_len 2048 --learning_rate 1e-5 --weight_decay 0.1 --num_train_epochs 500 --num_train_samples 3945 /home/chanho/Model/COMEDY/EPISODE/result/dataset/train_data.json --gradient_accumulation_steps 4 --lr_scheduler_type cosine --num_warmup_steps 400 --seed 42 --zero_stage 2 --save_interval 2000 --log_interval 100 --eval_interval 100 --output_dir /home/chanho/Model/COMEDY/EPISODE/result/output_path/2024-05-08-09.46.55 --gradient_checkpointing --local_rank 2 --tensorboard_path /home/chanho/Model/COMEDY/EPISODE/result/log_path/2024-05-08-09.46.55
[2024-05-08 10:46:59,552] [INFO] [real_accelerator.py:203:get_accelerator] Setting ds_accelerator to cuda (auto detect)
[93m [WARNING] [0m async_io requires the dev libaio .so object and headers but these were not found.
[93m [WARNING] [0m async_io: please install the libaio-dev package with apt
[93m [WARNING] [0m If libaio is already installed (perhaps from source), try setting the CFLAGS and LDFLAGS environment variables to where it can be found.
[93m [WARNING] [0m Please specify the CUTLASS repo directory as environment variable $CUTLASS_PATH
[93m [WARNING] [0m sparse_attn requires a torch version >= 1.5 and < 2.0 but detected 2.3
[93m [WARNING] [0m using untested triton version (2.3.0), only 1.0.0 is known to be compatible
[2024-05-08 10:47:00,070] [INFO] [launch.py:146:main] WORLD INFO DICT: {'localhost': [0, 1]}
[2024-05-08 10:47:00,070] [INFO] [launch.py:152:main] nnodes=1, num_local_procs=2, node_rank=0
[2024-05-08 10:47:00,070] [INFO] [launch.py:163:main] global_rank_mapping=defaultdict(<class 'list'>, {'localhost': [0, 1]})
[2024-05-08 10:47:00,070] [INFO] [launch.py:164:main] dist_world_size=2
[2024-05-08 10:47:00,070] [INFO] [launch.py:168:main] Setting CUDA_VISIBLE_DEVICES=0,1
[2024-05-08 10:47:00,070] [INFO] [launch.py:256:main] process 1725862 spawned with command: ['/home/chanho/anaconda3/envs/COMEDY/bin/python', '-u', 'training/SFT/main.py', '--local_rank=0', '--model_name_or_path', '/home/chanho/Model/COMEDY/EPISODE/result/model_path', '--train_data_path', '/home/chanho/Model/COMEDY/EPISODE/result/dataset/train_data.json', '--valid_data_path', '/home/chanho/Model/COMEDY/EPISODE/result/dataset/test_data.json', '--per_device_train_batch_size', '1', '--per_device_eval_batch_size', '1', '--data_output_path', '/home/chanho/Model/COMEDY/EPISODE/result/output_path/data', '--max_seq_len', '2048', '--learning_rate', '1e-5', '--weight_decay', '0.1', '--num_train_epochs', '500', '--num_train_samples', '3945', '/home/chanho/Model/COMEDY/EPISODE/result/dataset/train_data.json', '--gradient_accumulation_steps', '4', '--lr_scheduler_type', 'cosine', '--num_warmup_steps', '400', '--seed', '42', '--zero_stage', '2', '--save_interval', '2000', '--log_interval', '100', '--eval_interval', '100', '--output_dir', '/home/chanho/Model/COMEDY/EPISODE/result/output_path/2024-05-08-09.46.55', '--gradient_checkpointing', '--local_rank', '2', '--tensorboard_path', '/home/chanho/Model/COMEDY/EPISODE/result/log_path/2024-05-08-09.46.55']
[2024-05-08 10:47:00,071] [INFO] [launch.py:256:main] process 1725863 spawned with command: ['/home/chanho/anaconda3/envs/COMEDY/bin/python', '-u', 'training/SFT/main.py', '--local_rank=1', '--model_name_or_path', '/home/chanho/Model/COMEDY/EPISODE/result/model_path', '--train_data_path', '/home/chanho/Model/COMEDY/EPISODE/result/dataset/train_data.json', '--valid_data_path', '/home/chanho/Model/COMEDY/EPISODE/result/dataset/test_data.json', '--per_device_train_batch_size', '1', '--per_device_eval_batch_size', '1', '--data_output_path', '/home/chanho/Model/COMEDY/EPISODE/result/output_path/data', '--max_seq_len', '2048', '--learning_rate', '1e-5', '--weight_decay', '0.1', '--num_train_epochs', '500', '--num_train_samples', '3945', '/home/chanho/Model/COMEDY/EPISODE/result/dataset/train_data.json', '--gradient_accumulation_steps', '4', '--lr_scheduler_type', 'cosine', '--num_warmup_steps', '400', '--seed', '42', '--zero_stage', '2', '--save_interval', '2000', '--log_interval', '100', '--eval_interval', '100', '--output_dir', '/home/chanho/Model/COMEDY/EPISODE/result/output_path/2024-05-08-09.46.55', '--gradient_checkpointing', '--local_rank', '2', '--tensorboard_path', '/home/chanho/Model/COMEDY/EPISODE/result/log_path/2024-05-08-09.46.55']
[2024-05-08 10:47:02,600] [INFO] [real_accelerator.py:203:get_accelerator] Setting ds_accelerator to cuda (auto detect)
[2024-05-08 10:47:02,602] [INFO] [real_accelerator.py:203:get_accelerator] Setting ds_accelerator to cuda (auto detect)
[93m [WARNING] [0m async_io requires the dev libaio .so object and headers but these were not found.
[93m [WARNING] [0m async_io requires the dev libaio .so object and headers but these were not found.
[93m [WARNING] [0m async_io: please install the libaio-dev package with apt
[93m [WARNING] [0m If libaio is already installed (perhaps from source), try setting the CFLAGS and LDFLAGS environment variables to where it can be found.
[93m [WARNING] [0m Please specify the CUTLASS repo directory as environment variable $CUTLASS_PATH
[93m [WARNING] [0m async_io: please install the libaio-dev package with apt
[93m [WARNING] [0m If libaio is already installed (perhaps from source), try setting the CFLAGS and LDFLAGS environment variables to where it can be found.
[93m [WARNING] [0m Please specify the CUTLASS repo directory as environment variable $CUTLASS_PATH
[93m [WARNING] [0m sparse_attn requires a torch version >= 1.5 and < 2.0 but detected 2.3
[93m [WARNING] [0m using untested triton version (2.3.0), only 1.0.0 is known to be compatible
[93m [WARNING] [0m sparse_attn requires a torch version >= 1.5 and < 2.0 but detected 2.3
[93m [WARNING] [0m using untested triton version (2.3.0), only 1.0.0 is known to be compatible
/home/chanho/anaconda3/envs/COMEDY/lib/python3.11/site-packages/transformers/deepspeed.py:23: FutureWarning: transformers.deepspeed module is deprecated and will be removed in a future version. Please import deepspeed modules directly from transformers.integrations
  warnings.warn(
/home/chanho/anaconda3/envs/COMEDY/lib/python3.11/site-packages/transformers/deepspeed.py:23: FutureWarning: transformers.deepspeed module is deprecated and will be removed in a future version. Please import deepspeed modules directly from transformers.integrations
  warnings.warn(
Namespace(data_path=['Dahoas/rm-static'], data_split='6,2,2', data_output_path='/home/chanho/Model/COMEDY/EPISODE/result/output_path/data', model_name_or_path='/home/chanho/Model/COMEDY/EPISODE/result/model_path', per_device_train_batch_size=1, per_device_eval_batch_size=1, max_seq_len=2048, learning_rate=1e-05, weight_decay=0.1, num_train_epochs=500, gradient_accumulation_steps=4, lr_scheduler_type=<SchedulerType.COSINE: 'cosine'>, num_warmup_steps=400, output_dir='/home/chanho/Model/COMEDY/EPISODE/result/output_path/2024-05-08-09.46.55', seed=42, local_rank=2, gradient_checkpointing=True, offload=False, zero_stage=2, lora_dim=0, lora_module_name='decoder.layers.', only_optimize_lora=False, tensorboard_path='/home/chanho/Model/COMEDY/EPISODE/result/log_path/2024-05-08-09.46.55', save_interval=2000, log_interval=100, eval_interval=100, train_data_path='/home/chanho/Model/COMEDY/EPISODE/result/dataset/train_data.json', valid_data_path='/home/chanho/Model/COMEDY/EPISODE/result/dataset/test_data.json', num_train_samples=3945, ntk_RoPE_scaling_ratio=1, deepspeed=False, deepspeed_config=None, deepscale=False, deepscale_config=None)
['/home/chanho/Model/COMEDY/EPISODE/result/dataset/train_data.json']
Namespace(data_path=['Dahoas/rm-static'], data_split='6,2,2', data_output_path='/home/chanho/Model/COMEDY/EPISODE/result/output_path/data', model_name_or_path='/home/chanho/Model/COMEDY/EPISODE/result/model_path', per_device_train_batch_size=1, per_device_eval_batch_size=1, max_seq_len=2048, learning_rate=1e-05, weight_decay=0.1, num_train_epochs=500, gradient_accumulation_steps=4, lr_scheduler_type=<SchedulerType.COSINE: 'cosine'>, num_warmup_steps=400, output_dir='/home/chanho/Model/COMEDY/EPISODE/result/output_path/2024-05-08-09.46.55', seed=42, local_rank=2, gradient_checkpointing=True, offload=False, zero_stage=2, lora_dim=0, lora_module_name='decoder.layers.', only_optimize_lora=False, tensorboard_path='/home/chanho/Model/COMEDY/EPISODE/result/log_path/2024-05-08-09.46.55', save_interval=2000, log_interval=100, eval_interval=100, train_data_path='/home/chanho/Model/COMEDY/EPISODE/result/dataset/train_data.json', valid_data_path='/home/chanho/Model/COMEDY/EPISODE/result/dataset/test_data.json', num_train_samples=3945, ntk_RoPE_scaling_ratio=1, deepspeed=False, deepspeed_config=None, deepscale=False, deepscale_config=None)
['/home/chanho/Model/COMEDY/EPISODE/result/dataset/train_data.json']
Traceback (most recent call last):
  File "/home/chanho/Model/COMEDY/EPISODE/training/SFT/main.py", line 441, in <module>
Traceback (most recent call last):
  File "/home/chanho/Model/COMEDY/EPISODE/training/SFT/main.py", line 441, in <module>
    main()
  File "/home/chanho/Model/COMEDY/EPISODE/training/SFT/main.py", line 201, in main
    torch.cuda.set_device(args.local_rank)
  File "/home/chanho/anaconda3/envs/COMEDY/lib/python3.11/site-packages/torch/cuda/__init__.py", line 399, in set_device
    main()
  File "/home/chanho/Model/COMEDY/EPISODE/training/SFT/main.py", line 201, in main
    torch._C._cuda_setDevice(device)
    torch.cuda.set_device(args.local_rank)RuntimeError
: CUDA error: invalid device ordinal
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

  File "/home/chanho/anaconda3/envs/COMEDY/lib/python3.11/site-packages/torch/cuda/__init__.py", line 399, in set_device
    torch._C._cuda_setDevice(device)
RuntimeError: CUDA error: invalid device ordinal
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1.
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

[2024-05-08 10:47:04,072] [INFO] [launch.py:319:sigkill_handler] Killing subprocess 1725862
[2024-05-08 10:47:04,072] [INFO] [launch.py:319:sigkill_handler] Killing subprocess 1725863
[2024-05-08 10:47:04,082] [ERROR] [launch.py:325:sigkill_handler] ['/home/chanho/anaconda3/envs/COMEDY/bin/python', '-u', 'training/SFT/main.py', '--local_rank=1', '--model_name_or_path', '/home/chanho/Model/COMEDY/EPISODE/result/model_path', '--train_data_path', '/home/chanho/Model/COMEDY/EPISODE/result/dataset/train_data.json', '--valid_data_path', '/home/chanho/Model/COMEDY/EPISODE/result/dataset/test_data.json', '--per_device_train_batch_size', '1', '--per_device_eval_batch_size', '1', '--data_output_path', '/home/chanho/Model/COMEDY/EPISODE/result/output_path/data', '--max_seq_len', '2048', '--learning_rate', '1e-5', '--weight_decay', '0.1', '--num_train_epochs', '500', '--num_train_samples', '3945', '/home/chanho/Model/COMEDY/EPISODE/result/dataset/train_data.json', '--gradient_accumulation_steps', '4', '--lr_scheduler_type', 'cosine', '--num_warmup_steps', '400', '--seed', '42', '--zero_stage', '2', '--save_interval', '2000', '--log_interval', '100', '--eval_interval', '100', '--output_dir', '/home/chanho/Model/COMEDY/EPISODE/result/output_path/2024-05-08-09.46.55', '--gradient_checkpointing', '--local_rank', '2', '--tensorboard_path', '/home/chanho/Model/COMEDY/EPISODE/result/log_path/2024-05-08-09.46.55'] exits with return code = 1
